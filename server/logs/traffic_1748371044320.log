WARNING: Running pip as the 'root' user can result in broken permissions and conflicting behaviour with the system package manager, possibly rendering your system unusable. It is recommended to use a virtual environment instead: https://pip.pypa.io/warnings/venv. Use the --root-user-action option if you know what you are doing and want to suppress this warning.
[18:37:25] [INFO] Setting up Traffic Generator 1 with IP 10.0.0.4 connecting to Moat at 10.0.0.2
[18:37:25] [INFO] Virtualized environment detected: kvm
[18:37:25] [INFO] System memory: 0.9 GB
[18:37:25] [INFO] NUMA nodes: 1
[18:37:25] [INFO] NIC driver: virtio_net
[18:37:25] [INFO] virtio_net detected - Generic XDP mode support
[18:37:25] [INFO] DPDK packages available in repository
[18:37:25] [INFO] Resource allocation for tgen: 1 DPDK cores, 1 reserved cores, 1GB hugepages
[18:37:25] [INFO] Installing AF_XDP dependencies
[18:37:25] [INFO] Installing packages with resilience: clang llvm libelf-dev
[18:37:25] [INFO] Updating apt repositories with resiliency measures
[18:37:25] [INFO] APT update attempt 1/3
[18:37:31] [INFO] APT repositories updated successfully
[18:37:31] [INFO] Installation attempt 1/3
[18:37:31] [INFO] Successfully installed packages: clang llvm libelf-dev
[18:37:31] [INFO] Installing packages with resilience: gcc-multilib build-essential
[18:37:31] [INFO] Updating apt repositories with resiliency measures
[18:37:31] [INFO] APT update attempt 1/3
[18:37:33] [INFO] APT repositories updated successfully
[18:37:33] [INFO] Installation attempt 1/3
[18:37:33] [INFO] Successfully installed packages: gcc-multilib build-essential
[18:37:33] [INFO] Installing packages with resilience: linux-tools-generic python3-pip ethtool
[18:37:33] [INFO] Updating apt repositories with resiliency measures
[18:37:33] [INFO] APT update attempt 1/3
[18:37:35] [INFO] APT repositories updated successfully
[18:37:35] [INFO] Installation attempt 1/3
[18:37:35] [INFO] Successfully installed packages: linux-tools-generic python3-pip ethtool
[18:37:35] [INFO] Installing packages with resilience: libpcap-dev libbpf-dev pip python3-numpy
[18:37:35] [INFO] Updating apt repositories with resiliency measures
[18:37:35] [INFO] APT update attempt 1/3
[18:37:37] [INFO] APT repositories updated successfully
[18:37:37] [INFO] Installation attempt 1/3
[18:37:38] [INFO] Successfully installed packages: libpcap-dev libbpf-dev pip python3-numpy
[18:37:38] [INFO] AF_XDP dependencies installed
[18:37:38] [CMD] sysctl -w net.core.rmem_max=268435456
[18:37:38] [CMD] sysctl -w net.core.wmem_max=268435456
[18:37:38] [CMD] sysctl -w net.core.optmem_max=134217728
[18:37:38] [CMD] sysctl -w net.ipv4.tcp_rmem=4096 87380 134217728
[18:37:38] [CMD] sysctl -w net.ipv4.tcp_wmem=4096 65536 134217728
[18:37:38] [CMD] sysctl -w net.core.netdev_max_backlog=1000000
[18:37:38] [CMD] sysctl -w net.core.somaxconn=1048576
[18:37:38] [CMD] sysctl -w net.ipv4.ip_forward=1
[18:37:38] [CMD] sysctl -w net.ipv4.conf.all.accept_redirects=0
[18:37:38] [CMD] sysctl -w net.ipv4.conf.default.accept_redirects=0
[18:37:38] [CMD] sysctl -w net.ipv4.conf.all.send_redirects=0
[18:37:38] [CMD] sysctl -w net.ipv4.conf.default.send_redirects=0
[18:37:38] [CMD] sysctl -w net.ipv4.conf.all.accept_local=1
[18:37:38] [CMD] sysctl -w net.ipv4.conf.default.accept_local=1
[18:37:38] [CMD] sysctl -w net.ipv4.ip_forward_use_pmtu=1
[18:37:38] [CMD] sysctl -w net.core.bpf_jit_enable=1
[18:37:38] [CMD] sysctl -w net.core.bpf_jit_harden=0
[18:37:38] [CMD] sysctl -w net.core.bpf_jit_kallsyms=1
[18:37:38] [CMD] sysctl -w net.core.netdev_budget=50000
[18:37:38] [CMD] sysctl -w net.core.netdev_budget_usecs=5000
[18:37:38] [CMD] sysctl -w net.core.flow_limit_table_len=8192
[18:37:38] [INFO] Kernel parameters optimized for tunnel performance
[18:37:38] [CMD] ip tunnel add gre-moat mode gre local 10.0.0.4 remote 10.0.0.2 ttl inherit key 20001
[18:37:38] [CMD] ip link set gre-moat mtu 1465
[18:37:38] [CMD] ip addr add 192.168.114.1/30 dev gre-moat
[18:37:38] [CMD] ip link set gre-moat up
[18:37:38] [CMD] sysctl -w net.ipv4.conf.gre-moat.rp_filter=0
[18:37:38] [CMD] sysctl -w net.ipv4.conf.gre-moat.accept_source_route=1
[18:37:38] [CMD] sysctl -w net.ipv4.conf.gre-moat.route_localnet=1
[18:37:38] [CMD] sysctl -w net.ipv4.conf.gre-moat.accept_redirects=0
[18:37:38] [CMD] sysctl -w net.ipv4.conf.gre-moat.send_redirects=0
[18:37:38] [CMD] sysctl -w net.ipv4.conf.gre-moat.accept_local=1
[18:37:38] [CMD] sysctl -w net.ipv4.conf.gre-moat.forwarding=1
[18:37:38] [WARN] Skipping mtu_probing for gre-moat as /proc/sys/net/ipv4/conf/gre-moat/mtu_probing does not exist
[18:37:38] [INFO] Tunnel interface gre-moat optimized for performance
[18:37:38] [CMD] ip tunnel add ipip-tgen-1 mode ipip local 192.168.114.1 remote 192.168.114.2 ttl inherit
[18:37:38] [CMD] ip link set ipip-tgen-1 mtu 1445
[18:37:38] [CMD] ip addr add 10.200.77.2/32 dev ipip-tgen-1
[18:37:38] [CMD] ip link set ipip-tgen-1 up
[18:37:38] [CMD] sysctl -w net.ipv4.conf.ipip-tgen-1.rp_filter=0
[18:37:38] [CMD] sysctl -w net.ipv4.conf.ipip-tgen-1.accept_source_route=1
[18:37:38] [CMD] sysctl -w net.ipv4.conf.ipip-tgen-1.route_localnet=1
[18:37:38] [CMD] sysctl -w net.ipv4.conf.ipip-tgen-1.accept_redirects=0
[18:37:38] [CMD] sysctl -w net.ipv4.conf.ipip-tgen-1.send_redirects=0
[18:37:38] [CMD] sysctl -w net.ipv4.conf.ipip-tgen-1.accept_local=1
[18:37:38] [CMD] sysctl -w net.ipv4.conf.ipip-tgen-1.forwarding=1
[18:37:38] [WARN] Skipping mtu_probing for ipip-tgen-1 as /proc/sys/net/ipv4/conf/ipip-tgen-1/mtu_probing does not exist
[18:37:38] [INFO] Tunnel interface ipip-tgen-1 optimized for performance
[18:37:38] [CMD] ip route add 10.0.0.1 via 192.168.114.2 dev gre-moat metric 100
[18:37:38] [CMD] ip route add 10.0.0.0/8 via 192.168.114.2 dev gre-moat metric 101
[18:37:38] [CMD] ip rule add iif ipip-tgen-1 lookup 100 pref 100
[18:37:38] [CMD] ip rule add from 10.0.0.0/8 iif ipip-tgen-1 lookup 100 pref 101
[18:37:38] [CMD] ip rule add oif ipip-tgen-1 lookup 100 pref 102
[18:37:38] [CMD] ip route add default via 192.168.114.2 dev gre-moat table 100
[18:37:38] [CMD] ip route add 10.0.0.0/8 via 192.168.114.2 dev gre-moat table 100
[18:37:38] [INFO] Setting up enhanced acceleration for tgen
[18:37:38] [INFO] Applying advanced kernel optimizations for overlay network
[18:37:38] [INFO] Advanced kernel optimizations applied
[18:37:38] [INFO] Kernel optimizations applied
[18:37:38] [INFO] Setting up 1GB of hugepages for DPDK
[18:37:38] [INFO] Using 1 1GB hugepages
[18:37:38] [CMD] sysctl -w vm.nr_hugepages=1
[18:37:38] [CMD] mount -t hugetlbfs nodev /mnt/huge
[18:37:38] [CMD] grep Huge /proc/meminfo
[18:37:38] AnonHugePages:         0 kB
ShmemHugePages:        0 kB
FileHugePages:         0 kB
HugePages_Total:       1
HugePages_Free:        1
HugePages_Rsvd:        0
HugePages_Surp:        0
Hugepagesize:       2048 kB
Hugetlb:            2048 kB

[18:37:38] [INFO] Hugepages setup complete
[18:37:38] [INFO] Optimizing CPU scheduling and IRQ handling
[18:37:38] [INFO] CPU scheduling and IRQ handling optimized
[18:37:38] [INFO] CPU and IRQ optimization complete
[18:37:38] [INFO] Applying virtio-specific optimizations
[18:37:38] [INFO] Virtio-specific optimizations applied
[18:37:38] [INFO] Virtio-specific optimizations complete
[18:37:38] [INFO] Enhancing DPDK for virtio environments
[18:37:39] [INFO] DPDK optimized for virtualized environment
[18:37:39] [INFO] DPDK optimization complete
[18:37:39] [INFO] Enhanced acceleration setup complete for tgen
[18:37:39] [CMD] iptables -A INPUT -p icmp -j ACCEPT
[18:37:39] [CMD] iptables -A OUTPUT -p icmp -j ACCEPT
[18:37:39] [INFO] Tgen node setup complete with enhanced acceleration
[18:37:39] [INFO] You can now use 10.200.77.2 for tunnel traffic
2025-05-27 18:37:39,783 [INFO] Interface ipip-tgen-1 is up with MTU 1445.
2025-05-27 18:37:39,784 [INFO] Pre-computed max TCP payload size: 1405, UDP payload size: 1417
2025-05-27 18:37:39,784 [INFO] Initialized UDPHybridFlood targeting ['10.0.0.1'] on ipip-tgen-1 for 120s
2025-05-27 18:37:39,784 [INFO] Lock acquired: /tmp/traffic_shaping.lock
Error: Cannot delete qdisc with handle of zero.
2025-05-27 18:37:39,787 [INFO] Traffic shaping removed on ipip-tgen-1.
2025-05-27 18:37:39,787 [INFO] Lock released.
2025-05-27 18:37:39,787 [INFO] Script completed.
