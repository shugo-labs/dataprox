WARNING: Running pip as the 'root' user can result in broken permissions and conflicting behaviour with the system package manager, possibly rendering your system unusable. It is recommended to use a virtual environment instead: https://pip.pypa.io/warnings/venv. Use the --root-user-action option if you know what you are doing and want to suppress this warning.
[20:07:07] [INFO] Setting up Traffic Generator 1 with IP 10.0.0.4 connecting to Moat at 10.0.0.2
[20:07:07] [INFO] Virtualized environment detected: kvm
[20:07:07] [INFO] System memory: 0.9 GB
[20:07:07] [INFO] NUMA nodes: 1
[20:07:07] [INFO] NIC driver: virtio_net
[20:07:07] [INFO] virtio_net detected - Generic XDP mode support
[20:07:07] [INFO] DPDK packages available in repository
[20:07:07] [INFO] Resource allocation for tgen: 1 DPDK cores, 1 reserved cores, 1GB hugepages
[20:07:07] [INFO] Installing AF_XDP dependencies
[20:07:07] [INFO] Installing packages with resilience: clang llvm libelf-dev
[20:07:07] [INFO] Updating apt repositories with resiliency measures
[20:07:07] [INFO] APT update attempt 1/3
[20:07:09] [INFO] APT repositories updated successfully
[20:07:09] [INFO] Installation attempt 1/3
[20:07:09] [INFO] Successfully installed packages: clang llvm libelf-dev
[20:07:09] [INFO] Installing packages with resilience: gcc-multilib build-essential
[20:07:09] [INFO] Updating apt repositories with resiliency measures
[20:07:09] [INFO] APT update attempt 1/3
[20:07:12] [INFO] APT repositories updated successfully
[20:07:12] [INFO] Installation attempt 1/3
[20:07:12] [INFO] Successfully installed packages: gcc-multilib build-essential
[20:07:12] [INFO] Installing packages with resilience: linux-tools-generic python3-pip ethtool
[20:07:12] [INFO] Updating apt repositories with resiliency measures
[20:07:12] [INFO] APT update attempt 1/3
[20:07:14] [INFO] APT repositories updated successfully
[20:07:14] [INFO] Installation attempt 1/3
[20:07:15] [INFO] Successfully installed packages: linux-tools-generic python3-pip ethtool
[20:07:15] [INFO] Installing packages with resilience: libpcap-dev libbpf-dev pip python3-numpy
[20:07:15] [INFO] Updating apt repositories with resiliency measures
[20:07:15] [INFO] APT update attempt 1/3
[20:07:17] [INFO] APT repositories updated successfully
[20:07:17] [INFO] Installation attempt 1/3
[20:07:18] [INFO] Successfully installed packages: libpcap-dev libbpf-dev pip python3-numpy
[20:07:18] [INFO] AF_XDP dependencies installed
[20:07:18] [CMD] sysctl -w net.core.rmem_max=268435456
[20:07:18] [CMD] sysctl -w net.core.wmem_max=268435456
[20:07:18] [CMD] sysctl -w net.core.optmem_max=134217728
[20:07:18] [CMD] sysctl -w net.ipv4.tcp_rmem=4096 87380 134217728
[20:07:18] [CMD] sysctl -w net.ipv4.tcp_wmem=4096 65536 134217728
[20:07:18] [CMD] sysctl -w net.core.netdev_max_backlog=1000000
[20:07:18] [CMD] sysctl -w net.core.somaxconn=1048576
[20:07:18] [CMD] sysctl -w net.ipv4.ip_forward=1
[20:07:18] [CMD] sysctl -w net.ipv4.conf.all.accept_redirects=0
[20:07:18] [CMD] sysctl -w net.ipv4.conf.default.accept_redirects=0
[20:07:18] [CMD] sysctl -w net.ipv4.conf.all.send_redirects=0
[20:07:18] [CMD] sysctl -w net.ipv4.conf.default.send_redirects=0
[20:07:18] [CMD] sysctl -w net.ipv4.conf.all.accept_local=1
[20:07:18] [CMD] sysctl -w net.ipv4.conf.default.accept_local=1
[20:07:18] [CMD] sysctl -w net.ipv4.ip_forward_use_pmtu=1
[20:07:18] [CMD] sysctl -w net.core.bpf_jit_enable=1
[20:07:18] [CMD] sysctl -w net.core.bpf_jit_harden=0
[20:07:18] [CMD] sysctl -w net.core.bpf_jit_kallsyms=1
[20:07:18] [CMD] sysctl -w net.core.netdev_budget=50000
[20:07:18] [CMD] sysctl -w net.core.netdev_budget_usecs=5000
[20:07:18] [CMD] sysctl -w net.core.flow_limit_table_len=8192
[20:07:18] [INFO] Kernel parameters optimized for tunnel performance
[20:07:18] [CMD] ip tunnel add gre-moat mode gre local 10.0.0.4 remote 10.0.0.2 ttl inherit key 20001
[20:07:18] [CMD] ip link set gre-moat mtu 1465
[20:07:18] [CMD] ip addr add 192.168.114.1/30 dev gre-moat
[20:07:18] [CMD] ip link set gre-moat up
[20:07:18] [CMD] sysctl -w net.ipv4.conf.gre-moat.rp_filter=0
[20:07:18] [CMD] sysctl -w net.ipv4.conf.gre-moat.accept_source_route=1
[20:07:18] [CMD] sysctl -w net.ipv4.conf.gre-moat.route_localnet=1
[20:07:18] [CMD] sysctl -w net.ipv4.conf.gre-moat.accept_redirects=0
[20:07:18] [CMD] sysctl -w net.ipv4.conf.gre-moat.send_redirects=0
[20:07:18] [CMD] sysctl -w net.ipv4.conf.gre-moat.accept_local=1
[20:07:18] [CMD] sysctl -w net.ipv4.conf.gre-moat.forwarding=1
[20:07:18] [WARN] Skipping mtu_probing for gre-moat as /proc/sys/net/ipv4/conf/gre-moat/mtu_probing does not exist
[20:07:18] [INFO] Tunnel interface gre-moat optimized for performance
[20:07:18] [CMD] ip tunnel add ipip-tgen-1 mode ipip local 192.168.114.1 remote 192.168.114.2 ttl inherit
[20:07:18] [CMD] ip link set ipip-tgen-1 mtu 1445
[20:07:18] [CMD] ip addr add 10.200.77.2/32 dev ipip-tgen-1
[20:07:18] [CMD] ip link set ipip-tgen-1 up
[20:07:18] [CMD] sysctl -w net.ipv4.conf.ipip-tgen-1.rp_filter=0
[20:07:18] [CMD] sysctl -w net.ipv4.conf.ipip-tgen-1.accept_source_route=1
[20:07:18] [CMD] sysctl -w net.ipv4.conf.ipip-tgen-1.route_localnet=1
[20:07:18] [CMD] sysctl -w net.ipv4.conf.ipip-tgen-1.accept_redirects=0
[20:07:18] [CMD] sysctl -w net.ipv4.conf.ipip-tgen-1.send_redirects=0
[20:07:18] [CMD] sysctl -w net.ipv4.conf.ipip-tgen-1.accept_local=1
[20:07:18] [CMD] sysctl -w net.ipv4.conf.ipip-tgen-1.forwarding=1
[20:07:18] [WARN] Skipping mtu_probing for ipip-tgen-1 as /proc/sys/net/ipv4/conf/ipip-tgen-1/mtu_probing does not exist
[20:07:18] [INFO] Tunnel interface ipip-tgen-1 optimized for performance
[20:07:18] [CMD] ip route add 10.0.0.1 via 192.168.114.2 dev gre-moat metric 100
[20:07:18] [CMD] ip route add 10.0.0.0/8 via 192.168.114.2 dev gre-moat metric 101
[20:07:18] [CMD] ip rule add iif ipip-tgen-1 lookup 100 pref 100
[20:07:18] [CMD] ip rule add from 10.0.0.0/8 iif ipip-tgen-1 lookup 100 pref 101
[20:07:18] [CMD] ip rule add oif ipip-tgen-1 lookup 100 pref 102
[20:07:18] [CMD] ip route add default via 192.168.114.2 dev gre-moat table 100
[20:07:18] [CMD] ip route add 10.0.0.0/8 via 192.168.114.2 dev gre-moat table 100
[20:07:18] [INFO] Setting up enhanced acceleration for tgen
[20:07:18] [INFO] Applying advanced kernel optimizations for overlay network
[20:07:18] [INFO] Advanced kernel optimizations applied
[20:07:18] [INFO] Kernel optimizations applied
[20:07:18] [INFO] Setting up 1GB of hugepages for DPDK
[20:07:18] [INFO] Using 1 1GB hugepages
[20:07:18] [CMD] sysctl -w vm.nr_hugepages=1
[20:07:18] [CMD] mount -t hugetlbfs nodev /mnt/huge
[20:07:18] [CMD] grep Huge /proc/meminfo
[20:07:18] AnonHugePages:         0 kB
ShmemHugePages:        0 kB
FileHugePages:         0 kB
HugePages_Total:       1
HugePages_Free:        1
HugePages_Rsvd:        0
HugePages_Surp:        0
Hugepagesize:       2048 kB
Hugetlb:            2048 kB

[20:07:18] [INFO] Hugepages setup complete
[20:07:18] [INFO] Optimizing CPU scheduling and IRQ handling
[20:07:18] [INFO] CPU scheduling and IRQ handling optimized
[20:07:18] [INFO] CPU and IRQ optimization complete
[20:07:18] [INFO] Applying virtio-specific optimizations
[20:07:19] [INFO] Virtio-specific optimizations applied
[20:07:19] [INFO] Virtio-specific optimizations complete
[20:07:19] [INFO] Enhancing DPDK for virtio environments
[20:07:19] [INFO] DPDK optimized for virtualized environment
[20:07:19] [INFO] DPDK optimization complete
[20:07:19] [INFO] Enhanced acceleration setup complete for tgen
[20:07:19] [CMD] iptables -A INPUT -p icmp -j ACCEPT
[20:07:19] [CMD] iptables -A OUTPUT -p icmp -j ACCEPT
[20:07:19] [INFO] Tgen node setup complete with enhanced acceleration
[20:07:19] [INFO] You can now use 10.200.77.2 for tunnel traffic
